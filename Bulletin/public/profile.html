<!DOCTYPE HTML>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html" charset="utf-8" />
	<link rel="stylesheet" type="text/css" href="Semantic-UI-master/dist/semantic.min.css">
    <script src="Semantic-UI-master/dist/semantic.min.js"></script>
	<title>Profile page</title>
	<link href="images/favicon.ico" rel="SHORTCUT ICON">
</head>

<style type="text/css">
 body {
      //background: url('http://vignette1.wikia.nocookie.net/vsbattles/images/a/a3/Black-windows_542931.jpg/revision/latest?cb=20150317090032') fixed;
   background: url('https://raw.githubusercontent.com/lance91633/gitTest/master/nhu060E.jpg') fixed;
	}
    
p {
  font-family: 'Open Sans', sans-serif;
  font-size: 20px;
  color: #666;
}
</style>

<body>
	
	
	<script src="/socket.io/socket.io.js"></script>
    <script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
	<!--
	<div class="ui top attached button" onclick="location.href='index.html' " ><a href="index.html">Back to Main Page</a></div>      
	-->
	
	<div class = "ui   container segment" >
		<button class="ui violet basic  button" onclick='window.location.href = "http://luffy.ee.ncku.edu.tw:8011/user"'><a><i class="arrow left icon"></i>Back</a></button>
		<a></a>
		<button class="ui violet basic right floated button" onclick='window.location.href = "http://luffy.ee.ncku.edu.tw:8011/new_project_format"'><a><i class="write icon"></i> Add a new project</a></button>
		<button class="ui violet basic right floated button"><a><i class="file image outline icon"></i> Upload your profilephoto</a></button>
		<br></br>
		<br></br>
		<center>
			<div id = "profile_photo">
				<img  class="ui  medium circular " src="images/profilePhoto.png" alt="" draggable="false"> 
			</div>
		</center>
		<br></br>
		<div class="ui grid">
			<div class = "four wide column" ></div>
			<div class = "eight wide column" >
				<table class="ui inverted grey  table">
				  <thead>
					
				  </thead>
				  <tbody>
					<tr>
					  <td>Account</td>
					  <td id = 'account'></td>
					</tr>
					<tr>
					  <td>Name</td>
					  <td id = 'name'></td> 
					</tr>
					<tr>
					  <td>Email</td>
					  <td id = 'email'></td> 
					</tr>
					<tr>
					  <td>Address</td>
					  <td id = 'addr'></td>  <!--2015/12/02-->
					</tr>
					<tr>
					  <td>Phone</td>
					  <td id = 'phone'></td> 
					</tr>
					<tr>
					  <td>Biography</td>
					  <td id = 'biography'></td> 
					</tr>
				  </tbody>
				  
				</table>
			</div>
			<div class = "four wide column" ></div>
		
		</div>
		
		<button type="button" class="ui positive button" id="d">Consume Record</button>
		<p id='record'>

		</p>
		
	</div>


	<script src="/socket.io/socket.io.js"></script>
	<script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
	<script>
		var socket = io();
		var count = 0;
		if (localStorage.account != null){ //先登入才能看個資

			socket.emit('req_profile', localStorage.account);
			socket.on('res_profile', function(data){
				//data = user_data JSON
				if(data == false){
					alert('getting profile failed.');
					window.location.href = "http://luffy.ee.ncku.edu.tw:8011/";
				}
					
				else{
					//lay out to html
					$('#account').html(data.account);		
					$('#name').html(data.name);				
					$('#email').html(data.email);
					$('#addr').html(data.addr); //2015/12/02
					$('#phone').html(data.phone);
					$('#biography').html(data.biography);
				}
			});
			
			
		}
		
		else{
			alert('Please log in first.');
			window.location.href = "http://luffy.ee.ncku.edu.tw:8011/";
		}
		$('#d').click(function(){
		    if(count%2 == 0){
			    socket.emit('get_record',localStorage.getItem('account'));
				count++
			}
			else{
			    $('#record').html('');
				count++;
			}
		});
			  
		socket.on('res_record',function(data){
			var str = '';
			for(i=0;i<data.length;i++){
				//str += 'You spent '+data[i].price*data[i].count+'$ on '+data[i].count * 10+'% of the article " '+data[i].topic+' " at '+data[i].date+'<br>';
				str+='<tr><td>'+'<a href="http://luffy.ee.ncku.edu.tw:8011/read_it"'+' onclick='+"'"+'localStorage.setItem("'+'topic",'+'"'+data[i].topic+'"'+')'+"'"+'>'+data[i].topic+'</a>'+'</td><td>'
						+data[i].count * 10	+'</td><td>'
						+data[i].price*data[i].count+'</td><td>'
						+data[i].date+'</td></tr>';
			}
			str = '<table class=\"ui celled table\"><thead><tr><th>Article</th><th>%</th><th>Money</th><th>Date</th></tr></thead><tbody>' + str + '</tbody></table>';
			$('#record').html(str);
			
		});	
		
	</script>
	
	<footer>
		<p>Copyright © 2015 <a href="index.html">Bulletin</a></p>
	</footer>
</body>
</html>